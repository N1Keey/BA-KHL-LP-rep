{% extends "_base.j2" %}
{% block styles %}
    {{ super() }}
    <style>
        #btn_addkh, #tf_addkh{
            display:inline;
            padding:0;
            height:30px;
        }
        #tf_addkh{width:74%}
        #btn_addkh{
            width:25%;
            margin-left: -3;
        }
        .kh_active{
            background-color:lightgreen
        }
        table {
            width: 100%;
            margin:0;
        }
        #btn_umstand{
            width:100%;
            height:100%;
        }
        .umstand_active{
            background-color:lightgreen
        }
        #btn_add {
            margin-left:-4;
        }
        .umstandcontent ul{
            height:67%;
            overflow:hidden; 
            overflow-y:scroll;
        }
        .umstandcontent li{
            border-bottom: 1px solid #ddd;
            height:30;
        }
        #btn_del{
            float:right;
        }
        #btn_contentchange{
            float:right;
        }
        .umstandcontent input[type=text]{
            width: initial;
        }
        #krankheit_√§ndern h3, button{
            display: inline;
        }
        .kh_umst√§nde{
            height:67%;
            overflow:hidden; 
            overflow-y:scroll;
        }
        #searchfield{
            width:90%;
        }
        #searchsubmit{
            width:10%;
        }
        .btns_umstand{
            margin-top:-14;
        }
    </style>
{% endblock %}
{% set active_link = 'Stoff' %}
{% block title %} <title>Stoff</title> {% endblock %}
{% block navbar %}
    {{ super() }}
{% endblock %}
{# Krankheitsauswahl #}
{% block left_navbar %}
    <div class='left_navbar'>
        <form action='/hinzuf√ºgen_Krankheit' method='POST'>
            <input type="text" id="tf_addkh" name="Krankheit_name" placeholder="Neue Krankheit:" autocomplete="off">
            <button type="submit" name= "Btn_add_Krankheit" id="btn_addkh">einf√ºgen</button>
        </form>
        {# Modus um Krankheiten zu Ursachen oder Komplikationen hinzu zuf√ºgen #}
        {% if mode=='uok_Addkhmode' and (active_umstand=='Ursachen' or active_umstand =='Komplikationen') %}
            <form action="hinzuf√ºgen_{{ active_umstand }}" method='POST'>
                {# Checkboxauswahl der Krankheiten die hinzugef√ºgt werden sollen #}
                <ul class="checkbox_krankheit">
                    {% for krankheit in krankheiten %}
                        <li>
                            <label class='kh_checkbox_label'>
                                {{ krankheit }}<input type="checkbox" name="checkbox_Krankheit" value="{{ krankheit }}" id="cbx_kh">
                            </label>
                        </li>
                    {% endfor %}
                </ul>
                <input type="hidden" name="active_krankheit" value="{{active_krankheit}}"> {# zuordnung zu aktiver Krankheit #}
                <input type="submit" name="uok_Addkh" value="Krankheit hinzuf√ºgen" id="btn_kh_cbxsubmit">
            </form>
        {% else %}
            {# Buttonauswahl der Krankheiten => Normaler Modus #}
            <form method='POST'>
                <ul class="Button_Krankheit">
                    {% for krankheit in krankheiten %}
                        <li>
                            {# kh_active => Button ist gr√ºnlich #}
                            <button {% if active_krankheit == krankheit %} class="kh_active" {% endif %} type="submit" name="active_krankheit" value="{{ krankheit }}" id="btn_kh">{{ krankheit }}</button>
                        </li>
                    {% endfor %}
                </ul>
            </form>
        {% endif %}
    </div>
{% endblock %}
{% block content %}
    <div class='content'>
        {# Suchfeld #}
        <form action='/suche' method='POST'>
            <span>
                <input type='text' name='searchfield' placeholder='Zu suchendes Element:' id='searchfield'><input type='submit' name='searchsubmit' value='Suche' id='searchsubmit'>
            </span>
        </form>
        <form method='POST'>
            {# Umstandsauswahl #}
            <table class='btns_umstand'>
                <tr>
                    {# umstand_active => Button ist gr√ºnlich #}
                    <th><button {% if active_umstand == 'Ursachen' %} class="umstand_active" {% endif %} type="submit" name="active_umstand" value="Ursachen" id="btn_umstand">Ursachen</button></th>
                    <th><button {% if active_umstand == 'Symptome' %} class="umstand_active" {% endif %} type="submit" name="active_umstand" value="Symptome" id="btn_umstand">Symptome</button></th>
                    <th><button {% if active_umstand == 'Komplikationen' %} class="umstand_active" {% endif %} type="submit" name="active_umstand" value="Komplikationen" id="btn_umstand">Komplikationen</button></th>
                    <th><button {% if active_umstand == 'Diagnostiken' %} class="umstand_active" {% endif %} type="submit" name="active_umstand" value="Diagnostiken" id="btn_umstand">Diagnostiken</button></th>
                    <th><button {% if active_umstand == 'Therapien' %} class="umstand_active" {% endif %} type="submit" name="active_umstand" value="Therapien" id="btn_umstand">Therapien</button></th>
                </tr>
            </table>
            <input type="hidden" name="active_krankheit" value="{{active_krankheit}}"> {# Damit aktive Krankheit weiter besteht auch nach neuladen durch Knopfdruck #}
        </form>
        {% if active_krankheit %}
            {# Krankheits√ºbersicht #}
            {# Hier kann Krankheit angepasst oder gel√∂scht werden #}
            {% if not active_umstand %} 
                {# Zwischensegment zum √Ñndern #}
                {% if element2change %}
                    <form action='/√§ndern_Krankheit' method='POST'>
                        <input type='text' name='elemupdate' value='{{ element2change }}' autocomplete="off">
                        <input type='submit' name='abbruch' value=Abbruch>
                        <input type='submit' name='khchange' value='√Ñndern'>
                        <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                    </form>
                {% elif element2delete %}
                {# Zwischensegment zum L√∂schen #}
                    <form action='/l√∂schen_Krankheit' method='POST'>
                        Sicher?
                        <input type='submit' name='abbruch' value=Abbruch>
                        <input type='submit' name='khdelete' value='Ja'>
                        <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                    </form>
                {% else %}
                {# L√∂sch- und √Ñnder-Button#}
                    <span id='krankheit_√§ndern'>
                        <form method='POST'>
                            <h3>{{active_krankheit}}</h3>
                            <button type = 'submit' name='√§ndern' value='{{ active_krankheit }}'>üñäÔ∏è</button>
                            <button type = 'submit' name='l√∂schen' value='{{ active_krankheit }}'>üóëÔ∏è</button>
                            <input type="hidden" name="active_krankheit" value="{{ active_krankheit }}">
                        </form>
                    </span>
                    {# Bildung von Krankheits√ºbersicht #}
                    {% for krankheit in krankheitendict %}
                        {% if krankheit.get('Krankheit') == active_krankheit %}
                            <ul class='kh_umst√§nde'>
                                {% for umstand in krankheit.get('Umst√§nde') %}
                                    <li><h5><b>{{umstand}}</b></h5></li>
                                        <ul>
                                            {% for element in krankheit.get('Umst√§nde').get(umstand) %}
                                                <li>{{ element }}</li>
                                            {% endfor %}
                                        </ul>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {# if active_umstand #}
            {% else %}
                {# Hinzuf√ºgen von Element zu Umstand der Krankheit #}
                <form action="hinzuf√ºgen_{{active_umstand}}" method='POST'>
                    <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                    <input type="hidden" name="active_umstand" value="{{active_umstand}}">
                    {% if not mode %} {# kein uok_Addkhmode #}
                        <input type="text" name="kh_new{{active_umstand}}" placeholder="Neue {{ active_umstand }}" autocomplete="off" autofocus id="tf_add">
                        <input type="submit" name="kh_add{{active_umstand}}" id="btn_add" value="hinzuf√ºgen">
                    {% else %}
                        {# Aktive Krankheit wird gezeigt, damit man sieht welche Aktiv ist #}
                        <h4> {{active_krankheit}} </h4> {# uok_Addkhmode aktiv => Navbar keine (aktive) Krankheitsbuttons => Krankheitscheckboxen #}
                    {% endif %}
                    {% if active_umstand == 'Ursachen' or active_umstand == 'Komplikationen' %}
                        <button type="submit" name="mode" value="uok_Addkhmode" id="btn_uok_joinkh">
                        {# uok_addmode Krankheiten hinzuf√ºgen oder Abbruch #}
                            {% if mode == 'uok_Addkhmode' %}Abbruch{% else %}Krankheit zu {{active_umstand}} hinzuf√ºgen{% endif %}
                        </button>
                    {% endif %}
                </form>
            {% endif %}
        {% else %}
            {# Umstand wird vor Krankheit ausgew√§hlt#}
            <p><--Erst Krankheit ausw√§hlen</p>
        {% endif %}
        {# Elemente des aktiven Umstands der aktiven Krankheit werden gezeigt #}
        {% if active_umstand %}
            <div class = 'umstandcontent'>
                <ul>
                    {% for element in umstandcontent %}
                        <li>
                            {# Namen√§nderung von Umstandselementen #}
                            {% if element2change==element %}
                                <form action='/√§ndern_{{ active_umstand }}' method='POST'>
                                    <input type='text' name='elemupdate' value='{{ element }}' autocomplete="off">
                                    <input type='submit' name='abbruch' value=Abbruch>
                                    <input type='submit' name='ch_alle' value='Alle'> {# Dieses Element wird f√ºr alle Krankheiten ge√§ndert #}
                                    <input type='submit' name='ch_nurdieses' value='Nur dieses Element'> {# Neues Element wird f√ºr diese Krankheit angelegt altes wird f√ºr diese entfernt #}
                                    <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                                    <input type="hidden" name="active_umstand" value="{{active_umstand}}">
                                    <input type="hidden" name="content" value="{{ element2change }}"> {# Element das ge√§ndert wird #}
                                </form>
                            {% elif element2delete==element %}
                                <form action='/l√∂schen_{{ active_umstand }}' method='POST'>
                                    {{ element }}
                                    <input type='submit' name='abbruch' value=Abbruch>
                                    <input type='submit' name='del_alle' value='Alle'> {# Element wird komplett aus Datenbank entfernt #}
                                    <input type='submit' name='del_nurdieses' value='Nur dieses Element'> {# Element wird nur aus Krankheit entfernt #}
                                    <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                                    <input type="hidden" name="active_umstand" value="{{active_umstand}}">
                                    <input type="hidden" name="content" value="{{ element2delete }}">{# Element das gel√∂scht wird #}
                                </form>
                            {% else %}
                            {# Elemente (der aktiven Krankheit und des aktiven Umstands) und ihre √§nder- und l√∂schbuttons #}
                                <span>
                                    <form method='POST'>
                                        {{ element }}
                                        <button type='submit' name='l√∂schen' value='{{ element }}' id='btn_del'>üóëÔ∏è</button>
                                        <button type = 'submit' name='√§ndern' value='{{ element }}' id='btn_contentchange'>üñäÔ∏è</button>
                                        <input type="hidden" name="active_krankheit" value="{{active_krankheit}}">
                                        <input type="hidden" name="active_umstand" value="{{active_umstand}}">
                                    </form>
                                </span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>      
{% endblock %}